# @package _global_

defaults:
  - option_retriever
  - override /model/module/reader_head: none
  - override /model/module/gradients: contrastive

base:
  batch_size: 32

trainer:
  max_steps: 29_900
  check_val_every_n_epoch: 2


model:
  optimizer_params:
    lr: 1e-5
  module:
    max_batch_size: 200 # chunk size for BERT during evaluation
    share_documents_across_batch: false
    retriever_head:
      target_scale_init: 0.1

    gradients:
      agg: prob

  parameters:
    alpha: 0
    reader_kl_weight: 0
    retriever_kl_weight: 0


datamodule:
  n_documents: 16

  sampler:
    total:
      train: ${datamodule.n_documents}
      validation: ${int_mul:2,${datamodule.n_documents}} # ${datamodule.n_retrieved_documents}
      test: ${datamodule.n_retrieved_documents}
    temperature: 1
    largest:
      train: false
      validation: false
      test: true

    # setting `from_uniform=True` means that the weights returned by the sampler will be
    # s(z) = p(z) / tau(z) * u(z) / p(z) = u(z) / tau(z)
    from_uniform: true

  # dataloader
  drop_last: ${model.module.share_documents_across_batch}


logger:
  wandb:
    group: option-retriever
    name: ytxn-F3-${hostname:}-${datamodule.dset_name}-${datamodule.corpus_name}-contrast-prob-${model.module.gradients._id}-${model.module.retriever_head._id}-${base.seed}
