# @package _global_

defaults:
  - base
  - override /datamodule: openqa
  - override /datamodule/builder: concat_openqa
  - override /datamodule/transform: view_reader_concat
  # set the classifier to None to avoid using the positive documents
  - override /datamodule/relevance_classifier: none
  - override /model: medqa_reader
#  - override /model/bert: mini.yaml #debug
#  - override /sys: local.yaml #debug

base:
  seed: null
  target_metric: validation/reader/Accuracy
  target_mode: max


trainer:
  gpus: 8 #debug
  checkpoint_callback: true #debug
  strategy: dp
  min_epochs: 1
  max_epochs: 1000
  accumulate_grad_batches: 2
  val_check_interval: 0.3 #debug

model:
  lr: 1e-5
  weight_decay: 1e-4
  dropout: 0
  bert:
    hidden_dropout_prob: 0.1
    attention_probs_dropout_prob: 0.1


datamodule:
  use_subset: false #debug
  train_batch_size: 16
  eval_batch_size: 32
  num_proc: 4
  num_workers: 16 #debug
  output_columns:
    - question.input_ids
    - question.attention_mask
    - document.input_ids
    - document.attention_mask
    - document.row_idx
    - document.match_score
    - document.retrieval_score
    - answer.input_ids
    - answer.attention_mask
    - answer.target

  # documents
  n_retrieved_documents: 100
  n_documents: 20
  # the properties bellow are only used if the relevance classifier is available
  max_pos_docs: null
  filter_unmatched: false
  select_mode: first

  # encoding tokens
  add_encoding_tokens: true
  add_special_tokens: true

  # builder options
  builder:
    corpus_builder:
      to_sentences: true
      use_subset: false # debug
      passage_length: 100 # todo: why smaller than 200?
      passage_stride: 50


# logger: null
# callbacks: null

logger:
  wandb:
    group: medqa-mop-reader # name your experiment here
